generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TradingCall {
  id              String   @id @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  callDate        DateTime

  // Stock details
  scriptName      String
  ltp             Float

  // Targets
  target1         Float
  target2         Float
  target3         Float?
  stopLoss        Float

  // Additional info
  patternType     String   // TR, UB, BF, etc.
  longTermOutlook String?
  rank            Int?
  topPick         Int?     // Top pick ranking (1, 2, 3, etc.)
  support         Float?
  resistance      Float?

  // Trade classification
  tradeType       String   @default("SWING") // SWING or LONG_TERM
  isFlashCard     Boolean  @default(false)   // Golden flash cards shown first
  eventMarker     String?                    // E for bonus/split/dividend events

  // Status tracking
  status          String   @default("ACTIVE") // ACTIVE, TARGET1_HIT, TARGET2_HIT, TARGET3_HIT, SL_HIT, EXPIRED
  currentPrice    Float?
  lastChecked     DateTime?

  // Result details
  target1Hit      Boolean  @default(false)
  target2Hit      Boolean  @default(false)
  target3Hit      Boolean  @default(false)
  stopLossHit     Boolean  @default(false)
  hitDate         DateTime? // Deprecated: use individual hit dates below

  // Individual target hit times
  target1HitDate  DateTime?
  target2HitDate  DateTime?
  target3HitDate  DateTime?
  stopLossHitDate DateTime?

  @@index([callDate])
  @@index([status])
  @@index([tradeType])
}

model AppConfig {
  id              String   @id @default(uuid())
  key             String   @unique
  value           String
  updatedAt       DateTime @updatedAt
}

model User {
  id                String    @id @default(uuid())
  username          String    @unique
  password          String    // Hashed password
  email             String    @unique
  fullName          String
  phone             String?

  // Approval status
  status            String    @default("PENDING") // PENDING, APPROVED, REJECTED

  // Subscription management
  isActive          Boolean   @default(false) // Activated only after admin approval
  subscriptionStart DateTime?
  subscriptionEnd   DateTime?

  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  approvedBy        String?   // Admin who approved
  approvedAt        DateTime?
  lastLogin         DateTime?

  // Notes for admin
  notes             String?

  @@index([username])
  @@index([email])
  @@index([status])
  @@index([subscriptionEnd])
}
